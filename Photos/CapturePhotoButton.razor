@using System.IO
@using Microsoft.Maui.Media
@using Microsoft.Maui.Storage

<MudStack Justify="Justify.Center" AlignItems="AlignItems.Center">
    <MudFab StartIcon="@Icons.Material.Filled.PhotoCamera" OnClick="CapturePhoto" Size="Size.Large" IconSize="Size.Large" Color="Color.Primary"/>
</MudStack>

@code {

    [Parameter]
    public EventCallback<string> OnPhotoCaptured { get; set; }
    
    private async Task CapturePhoto()
    {
        try
        {
            if (!MediaPicker.Default.IsCaptureSupported)
            {
                return;
            }
            
            FileResult photo = await MediaPicker.Default.CapturePhotoAsync();
            await using Stream stream = await photo.OpenReadAsync();
            using var memoryStream = new MemoryStream();
            await stream.CopyToAsync(memoryStream);

            string base64 = Convert.ToBase64String(memoryStream.ToArray());
            await OnPhotoCaptured.InvokeAsync(base64);
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }

}